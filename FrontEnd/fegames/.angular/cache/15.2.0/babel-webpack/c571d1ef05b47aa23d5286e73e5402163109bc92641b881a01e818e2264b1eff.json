{"ast":null,"code":"import { Observable, Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport class WebSocketService {\n  constructor() {}\n  connect(url) {\n    this.socket = new WebSocket(url);\n    const observable = new Observable(observer => {\n      this.socket.onmessage = event => observer.next(event);\n      this.socket.onerror = event => observer.error(event);\n      this.socket.onclose = event => observer.complete();\n      return () => {\n        this.socket.close();\n      };\n    });\n    const socketSubject = new Subject();\n    const socketDataSubject = new Subject();\n    const observer = {\n      next: data => {\n        if (this.socket.readyState === WebSocket.OPEN) {\n          this.socket.send(JSON.stringify(data));\n        }\n      }\n    };\n    socketSubject.subscribe(observer);\n    observable.subscribe(messageEvent => {\n      socketDataSubject.next(JSON.parse(messageEvent.data));\n    });\n    return socketDataSubject;\n  }\n  disconnect() {\n    if (this.socket) {\n      this.socket.close();\n    }\n  }\n  sendMovement(idMatch, movement) {\n    const message = {\n      type: 'MOVEMENT',\n      idMatch: idMatch,\n      movement: movement\n    };\n    this.socket$.next(message);\n  }\n  sendChat(target, message) {\n    const chatMessage = {\n      type: 'CHAT',\n      target: target,\n      message: message\n    };\n    this.socket$.next(chatMessage);\n  }\n  sendBroadcast(message) {\n    const broadcastMessage = {\n      type: \"BROADCAST\",\n      message: message\n    };\n    console.log(\"11111111\");\n    console.log(JSON.stringify(broadcastMessage));\n    this.socket$.next(JSON.stringify(broadcastMessage));\n  }\n  sendBroaadcast(message) {\n    const broadcastMessage = {\n      type: \"BROADCAST\",\n      message: message\n    };\n    console.log(broadcastMessage);\n    this.socket$.next(broadcastMessage);\n  }\n}\nWebSocketService.ɵfac = function WebSocketService_Factory(t) {\n  return new (t || WebSocketService)();\n};\nWebSocketService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: WebSocketService,\n  factory: WebSocketService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["Observable","Subject","WebSocketService","constructor","connect","url","socket","WebSocket","observable","observer","onmessage","event","next","onerror","error","onclose","complete","close","socketSubject","socketDataSubject","data","readyState","OPEN","send","JSON","stringify","subscribe","messageEvent","parse","disconnect","sendMovement","idMatch","movement","message","type","socket$","sendChat","target","chatMessage","sendBroadcast","broadcastMessage","console","log","sendBroaadcast","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\nacho\\OneDrive\\Documentos\\GitHub\\DISENO-APP\\FrontEnd\\fegames\\src\\app\\websocket.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Observable, Subject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class WebSocketService {\n  private socket!: WebSocket;\n  private socket$!: Subject<any>;\n\n  constructor() {}\n\n  public connect(url: string): Subject<any> {\n    this.socket = new WebSocket(url);\n\n    const observable = new Observable<MessageEvent>((observer) => {\n      this.socket.onmessage = (event) => observer.next(event);\n      this.socket.onerror = (event) => observer.error(event);\n      this.socket.onclose = (event) => observer.complete();\n\n      return () => {\n        this.socket.close();\n      };\n    });\n\n    const socketSubject = new Subject<MessageEvent>();\n    const socketDataSubject = new Subject<any>();\n\n    const observer = {\n      next: (data: Object) => {\n        if (this.socket.readyState === WebSocket.OPEN) {\n          this.socket.send(JSON.stringify(data));\n        }\n      },\n    };\n\n    socketSubject.subscribe(observer);\n    observable.subscribe((messageEvent) => {\n      socketDataSubject.next(JSON.parse(messageEvent.data));\n    });\n\n    return socketDataSubject;\n  }\n\n  public disconnect() {\n    if (this.socket) {\n      this.socket.close();\n    }\n  }\n\n  sendMovement(idMatch: number, movement: string) {\n    const message = {\n      type: 'MOVEMENT',\n      idMatch: idMatch,\n      movement: movement,\n    };\n    this.socket$.next(message);\n  }\n\n  sendChat(target: string, message: string) {\n    const chatMessage = {\n      type: 'CHAT',\n      target: target,\n      message: message,\n    };\n    this.socket$.next(chatMessage);\n  }\n\n  sendBroadcast(message: String) {\n    const broadcastMessage = {\n      type: \"BROADCAST\",\n      message: message,\n    };\n    console.log(\"11111111\")\n    console.log(JSON.stringify(broadcastMessage))\n\n    this.socket$.next(JSON.stringify(broadcastMessage));\n  }\n  sendBroaadcast(message: String) {\n    const broadcastMessage = {\n      type: \"BROADCAST\",\n      message: message,\n    };\n    console.log(broadcastMessage)\n    this.socket$.next(broadcastMessage);\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}